# Как все это сочетается друг с другом
Давайте рассмотрим, как можно объединить все гарантии распределенных транзакций.

Как мы уже часто говорили, транзакции должны предоставлять определенные гарантии, чтобы приложения могли извлечь из них пользу.

Распределенные транзакции должны предоставлять аналогичные гарантии.

# Гарантии, которые должны предоставлять распределенные системы
Некоторые основные гарантии, которые обычно используются, содержатся в аббревиатуре ACID , которую мы проанализировали ранее.

## Гарантии постоянства и долговечности
> Согласованность и долговечность не требуют существенного изменения обработки в распределенной среде по сравнению с централизованной системой с одним узлом. Для долговечности достаточно, чтобы данные хранились в энергонезависимой памяти до того, как они будут подтверждены клиентом.

Чтобы обеспечить надежность распределенной системы, необходимо хранить данные в более чем одной реплике перед подтверждением, чтобы система могла пережить отказы одного узла.

Для достижения согласованности система может вводить дополнительные операции чтения и записи в контексте транзакции, чтобы гарантировать сохранение согласованности приложения. Эти операции могут генерироваться автоматически, например, ограничения ссылочной целостности на основе внешних ключей или каскадов, или определяться приложением, например, через триггеры.

## Гарантии атомарности и изоляции
Гарантии атомарности и изолированности сохранить сложнее, и ранее мы проанализировали некоторые алгоритмы, которые можно использовать для этой цели.

В ходе курса были рассмотрены некоторые алгоритмы, которые могут помочь сохранить изоляцию между транзакциями, а также некоторые алгоритмы, которые могут помочь сохранить атомарность в распределенной системе.

# Объединение алгоритмов для гарантии всех свойств
Алгоритмы должны быть объединены, чтобы гарантировать все свойства: атомарность , согласованность , изолированность и долговечность .

Некоторые комбинации этих алгоритмов могут быть проще реализовать на практике благодаря их общим характеристикам. Например, двухфазная блокировка имеет очень похожие характеристики с двухфазной фиксацией , поэтому проще понять, как их можно комбинировать.

Spanner — пример системы, которая использует комбинацию этих двух методов для достиженияатомарностииизоляции, как объясняется далее в курсе.

# Сложность алгоритмов
Рассматривая представленные ранее алгоритмы, легко понять, что некоторые из них либо приводят к хрупкости (например, двухфазная фиксация), либо вносят в систему значительную дополнительную сложность (например, фиксация на основе кворума).

# Алгоритмы, которые работают для обеих систем
Представленные алгоритмы изоляции могут использоваться как в централизованных, так и в распределённых системах. Однако их применение в распределённой системе имеет ряд дополнительных последствий.

Например, двухфазная блокировка требует использования распределенных блокировок, что не так-то просто реализовать в распределенной системе, как мы объясним далее в курсе.

Оптимистичные методы, такие как изоляция моментальных снимков, требуют передачи большого объема данных между различными узлами в распределенной системе, что отрицательно сказывается на производительности.

> Как следствие, использование транзакций в распределённой системе обходится дороже, чем в централизованной. Поэтому системы, которым не требуется распределённая обработка, могут быть спроектированы так, чтобы безопасно работать без неё.

Это также одна из причин, по которой многие распределенные базы данных либо не обеспечивают полной поддержки транзакций ACID, либо заставляют пользователя явно соглашаться на их использование.