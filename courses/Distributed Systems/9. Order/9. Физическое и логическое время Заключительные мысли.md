
# Физическое и логическое время: Заключительные мысли

Давайте завершим главы о времени и порядке с четким пониманием разницы между физическим и логическим временем и того, что каждое из них предлагает.

Надеемся, две предыдущие главы помогли нам понять разницу между концепциями физического и логического времени. В то же время, некоторые части подробно объясняли внутреннюю работу некоторых техник, их преимущества и недостатки. Это могло оставить у нас больше вопросов, поэтому в этом уроке будет представлен обзор того, что мы рассмотрели, и некоторые дополнительные замечания.

Давайте начнем с повторения основной разницы между физическим и логическим временем.

## Разница между физическим и логическим временем

### Физическое время

*Физическое время* измеряется на основе некоторых физических явлений. В зависимости от наблюдаемого явления, гранулярность *физического времени* может варьироваться от дней до секунд или наносекунд.

Во всех случаях время течет непрерывно между дискретными значениями.

> Время можно считать дискретным в контексте аппаратных или программных систем. Является ли это верным в других контекстах (т. е. в физике) — гораздо более серьезный вопрос, выходящий за рамки этой дискуссии.

*   В нераспределенной системе вычислительный узел может использовать эти измерения для связи происходящих событий и их сравнения друг с другом, чтобы определить, что произошло раньше.
*   В распределенной системе различные узлы имеют отдельные часы, которые могут быть не синхронизированы, поэтому им придется выполнять дополнительную работу, чтобы обеспечить безопасное сравнение значений их часов. Эта дополнительная работа включает обмен сообщениями между узлами, содержащими значения их часов, чтобы узлы могли соответствующим образом корректировать свои часы для их синхронизации.

### Логическое время

*Логическое время* не измеряется на основе физических явлений, а вместо этого использует локальные события для измерения *логического времени*.

Например, узел может поддерживать счетчик, который увеличивается каждый раз, когда что-то происходит. Таким образом, каждое событие все еще может быть связано с дискретным «моментом времени», но значение этого времени будет в основном относительным, а не абсолютным.

Более того, *логическое время* не будет течь непрерывно, а будет течь только тогда, когда на узле происходят события. Узел все равно сможет сравнивать локальные события и определять, какое из них произошло раньше.

Как упоминалось ранее, эти моменты времени не имеют абсолютной семантики. В результате в распределенной системе различным узлам придется обмениваться своим восприятием логического времени, чтобы они могли сравнивать значения своих логических часов и упорядочивать события на разных узлах (и часах).

## Важные моменты

> Прочитав о разнице между физическим и логическим временем, вы заметили что-нибудь интересное?

На первый взгляд, концепции физического и логического времени кажутся совершенно разными. Однако при ближайшем рассмотрении выясняется, что они довольно похожи и на самом деле имеют некоторые общие базовые свойства.

В обоих случаях время течет дискретными приращениями каждый раз, когда что-то происходит.

*   В случае *физического времени* происходящим является лежащее в основе физическое явление.
*   В случае *логического времени* это фактическое логическое событие, происходящее на узле.

В обоих случаях для синхронизации часов требуется связь между узлами.

*   В случае *физического времени* эта связь осуществляется непрерывно в фоновом режиме.
*   В случае *логического времени* эта связь осуществляется по требованию при отправке сообщений между узлами.

> Понимание того, что эти два понятия используют эти общие, базовые принципы, но несколько по-разному, полезно для понимания преимуществ и недостатков каждой концепции и того, где каждая из них может быть полезна.

## Преимущества и недостатки физического времени

По своей природе *физическое время* пытается выполнять всю необходимую координацию и связь в фоновом режиме, чтобы различные узлы могли устанавливать **порядок** без дополнительной координации, когда это необходимо.

В большинстве случаев физические часы используются для создания иллюзии **полного порядка**, что нереалистично в распределенной системе.

Кроме того, физические часы должны оставаться правильно синхронизированными, что может быть временно невозможно при сетевых разделах. Если **расхождение часов** между узлами превышает допустимую погрешность, это может означать, что **корректность** приложения нарушена.

## Преимущества и недостатки логического времени

*Логическое время* работает в предположении, что **сетевые разделы** — это данность, и **частичный порядок**, удовлетворяющий **причинности**, — это лучший вид упорядочивания, которого можно достичь в распределенной системе. Во время разделов разные узлы могут продолжать работать, по сути допуская *расхождение своих часов*.

Однако, когда разделы устраняются или узлы общаются друг с другом, они в конечном итоге могут обнаружить события, которые произошли параллельно, и выполнить необходимое согласование.

Логические часы также можно адаптировать так, чтобы фиксировались только необходимые причинно-следственные связи (а не все подряд), тем самым достигая хорошей ***производительности*** и ***безопасности***.

Однако, как объяснялось ранее, *логическое время* не течет само по себе, как *физическое время*; оно течет только тогда, когда происходят события. Следовательно, логическое время нельзя использовать для задач, требующих понятия реального времени (wall clock time), которое течет даже тогда, когда событий не происходит. Например, чтобы определить, медленно ли работает другой узел во время связи или, возможно, он вышел из строя, узел должен использовать ***тайм-ауты*** и ***физическое время***.

---

> **Задача**
>
> Представьте себе распределенную платформу электронной коммерции с серверами, расположенными в разных регионах. Пользователи взаимодействуют с платформой для просмотра товаров, добавления товаров в корзину и совершения покупок. Система стремится поддерживать точные временные метки для действий пользователей.
>
> Опишите, с какими проблемами, связанными с физическим и логическим временем, может столкнуться платформа в этой распределенной среде. Приведите конкретные примеры сценариев, в которых синхронизация физического времени и концепции логического времени, такие как векторные часы или часы Лэмпорта, играют решающую роль. Объясните, как эти механизмы учета времени могут решить проблемы и обеспечить согласованность в записи взаимодействий пользователей на распределенных серверах.
>
> <details>
>  <summary><b>Показать ответ</b></summary>
>
>
>  Для решения этой задачи давайте сосредоточимся на проблемах, связанных с физическим и логическим временем в распределенной платформе электронной коммерции.
>
>  **Физическое время**
>
>  Синхронизация физического времени критически важна для обеспечения того, чтобы действия пользователя, такие как добавление товаров в корзину и совершение покупок, получали точные временные метки в разных регионах. Это особенно важно, если пользователь взаимодействует с платформой из нескольких регионов за короткий промежуток времени.
>
>  **Логическое время**
>
>  Логическое время, в свою очередь, с помощью таких механизмов, как векторные часы или часы Лэмпорта, помогает сохранять правильную последовательность этих событий. Это гарантирует, что система может точно отразить порядок действий пользователя, даже если они происходят почти одновременно.
>
>  **Пример**
>
>  Предположим, пользователь добавляет товар в корзину на одном сервере, а затем быстро оформляет заказ на другом сервере в ином регионе.
>  *   **Синхронизация физического времени** гарантирует, что эти действия будут записаны в правильном хронологическом порядке.
>  *   **Концепции логического времени**, такие как векторные часы, помогают понять причинно-следственные связи между этими событиями (например, что оформление заказа не могло произойти до добавления товара в корзину). Это гарантирует, что система обработает их в той последовательности, в которой их совершил пользователь.
>
>  Внедрение этих механизмов учета времени позволяет платформе справляться с трудностями работы в распределенной среде, обеспечивая согласованность (консистентность) и точность записи взаимодействий пользователей на всех своих серверах.
> >  </details>