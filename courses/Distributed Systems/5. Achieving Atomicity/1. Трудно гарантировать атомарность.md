# Трудно гарантировать атомарность
Давайте выясним, почему атомарность труднодостижима в целом и почему это становится еще труднее в распределенных системах.

Вторым сложным аспектом транзакций, особенно распределенных транзакций, является атомарность .

Одним из преимуществ группировки операций внутри транзакции является гарантия того, что либо все они будут выполнены, либо ни одна из них. В результате разработчику приложения не нужно думать о сценариях частичных сбоев , когда транзакция терпит неудачу после того, как некоторые операции уже были выполнены.

> Подобно гарантиям изоляции , гарантия атомарности упрощает разработку приложений. Она делегирует часть сложности обработки таких ситуаций слою сохранения, например, хранилищу данных, используемому приложением, которое предоставляет гарантии атомарности .

Давайте посмотрим, почему атомарность труднодостижима в целом и почему это еще сложнее в распределенных системах.

# Гарантия атомарности — сложная проблема
Гарантировать атомарность вообще сложно, и не только в распределенных системах.

Причина в том, что компоненты могут неожиданно выйти из строя независимо от того, являются ли они программными или аппаратными компонентами.

По словам Пиллаи и др. , «даже простая операция записи нескольких байтов в файл требует дополнительной работы, чтобы гарантировать, что она будет выполнена атомарным образом, и файл не окажется в поврежденном состоянии, если диск выйдет из строя во время выполнения части операции».

# Способ достижения атомарности
Одним из распространенных способов достижения атомарности в этом случае является журналирование или запись с опережением . В этом методе метаданные об операции сначала записываются в отдельный файл вместе с маркерами, которые обозначают, была ли операция завершена или нет.

На основе этих данных система может определить, какие операции выполнялись, когда произошел сбой, и довести их до завершения, либо отменив их эффекты и прервав их, либо завершив оставшуюся часть и зафиксировав их. Этот подход широко используется в файловых системах и базах данных.

# Атомарность в распределенной системе
Проблема атомарности в распределенной системе становится еще более сложной, поскольку компоненты (в данном контексте узлы) разделены сетью, которая является медленной и ненадежной.

Более того, нам нужно не только убедиться, что операция выполняется атомарно в узле. В большинстве случаев нам нужно убедиться, что операция выполняется атомарно на нескольких узлах. Это означает, что операция должна вступить в силу либо на всех узлах, либо ни на одном из них. Эта проблема также известна как атомарная фиксация .

> Уроки 2PC , 3PC и протокол фиксации на основе кворума рассмотрят, как можно достичь атомарности в распределенных настройках. Алгоритмы обсуждаются в хронологическом порядке, чтобы мы могли понять, в чем заключаются подводные камни каждого алгоритма и как последующие алгоритмы их устраняли.