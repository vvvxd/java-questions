# Протокол OAuth

Давайте изучим протокол OAuth и узнаем, как он работает.

Во Всемирной паутине клиентом может быть **веб-браузер**, а сервером — **сервер приложений**.

Однако существуют более сложные сценарии, в которых задействовано больше сторон. Один из таких сценариев — когда одному серверу требуется авторизация от пользователя для получения данных этого пользователя с другого сервера. Например, это может произойти, когда почтовое приложение хочет получить список контактов ваших друзей из отдельного приложения социальной сети, чтобы добавить их в вашу адресную книгу. **OAuth** — это протокол, который позволяет сделать это безопасным способом.

> **Примечание:** Существует несколько версий этого протокола со значительными изменениями, но в этом уроке мы рассмотрим версию OAuth 2.0.

## Субъекты в протоколе OAuth
В протоколе OAuth есть четыре основных субъекта.

### Владелец ресурса
**Владелец ресурса** — это человек, который предоставляет доступ к части своих данных.

### Клиент
**Клиент** — это приложение, которое пытается получить доступ к некоторым данным пользователя, например, почтовое приложение в приведенном выше примере.

### Сервер ресурсов
**Сервер ресурсов** — это приложение, которое содержит данные пользователя, к которым запрашивается доступ, например, приложение социальной сети в приведенном выше примере.

### Сервер авторизации
**Сервер авторизации** — это сервер, который предоставляет интерфейс, где пользователь одобряет или отклоняет запрос на доступ к своим данным. В простых случаях это может быть тот же сервер, что и сервер ресурсов, но в более сложных сценариях они могут быть разными.

## Рабочий процесс протокола OAuth
На следующей иллюстрации представлена визуализация основного потока в протоколе OAuth:


*   **Шаг 1:** Сначала пользователь посещает веб-сайт клиентского приложения. Клиентское приложение перенаправляет пользователя на специальную веб-страницу сервера авторизации, предназначенную для OAuth. Запрос к серверу авторизации содержит некоторые дополнительные данные, такие как URI для перенаправления обратно в клиентское приложение, категория запрашиваемых пользовательских данных, идентификатор клиентского приложения и т.д.

*   **Шаг 2:** Сервер авторизации возвращает пользователю веб-страницу, на которой отображается подробное сообщение о запрашиваемых данных и о клиентском приложении, которое делает запрос. Пользователю предоставляется возможность разрешить или отклонить этот запрос.
    > **Примечание:** Если пользователь не вошел в систему на сервере авторизации, сначала будет показано приглашение для входа.

*   **Шаг 3:** Когда пользователь одобряет запрос, сервер авторизации перенаправляет его обратно в клиентское приложение. В частности, пользователь будет перенаправлен на URI перенаправления, указанный в первоначальном запросе, но этот URI будет дополнен некоторыми данными. Одним из важнейших элементов данных является **код авторизации**, выданный сервером авторизации, который будет представлять разрешение, данное пользователем приложению на доступ к его данным.

*   **Шаг 4:** Затем клиентское приложение сделает запрос к серверу авторизации, предоставив этот код авторизации в обмен на **токен доступа (access token)**. Помимо кода авторизации, клиентское приложение также предоставит свой идентификатор клиента и секретный ключ клиента.

*   **Шаг 5:** После этого клиентское приложение может использовать этот токен доступа для выполнения запроса к серверу ресурсов для получения данных пользователя.

При первом знакомстве с этим рабочим процессом может возникнуть вопрос, зачем нужны и код авторизации, и токен доступа. Основная причина этого заключается в том, что веб-браузер считается гораздо менее безопасной средой по сравнению с серверной частью клиентского приложения. Поэтому в веб-браузер передается только код авторизации, который сам по себе не позволяет получить данные пользователя без секретного ключа клиента, который надежно хранится в клиентском приложении.
