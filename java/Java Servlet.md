## Оглавление

### Сервлеты
1. [Что такое сервлет и какова его роль в веб-приложении?](#1-что-такое-сервлет-и-какова-его-роль-в-веб-приложении)
2. [Как работает жизненный цикл сервлета?](#2-как-работает-жизненный-цикл-сервлета)
3. [Как настроить сервлет в веб-приложении?](#3-как-настроить-сервлет-в-веб-приложении)
4. [Как сервлеты обрабатывают HTTP-запросы?](#4-как-сервлеты-обрабатывают-http-запросы)
5. [Как сервлеты взаимодействуют с параметрами и атрибутами запроса?](#5-как-сервлеты-взаимодействуют-с-параметрами-и-атрибутами-запроса)
6. [Что такое `ServletContext` и как он используется?](#6-что-такое-servletcontext-и-как-он-используется)
7. [Как работает сессия в сервлетах?](#7-как-работает-сессия-в-сервлетах)
8. [Как сервлеты поддерживают асинхронную обработку?](#8-как-сервлеты-поддерживают-асинхронную-обработку)
9. [Как сервлеты обрабатывают фильтры?](#9-как-сервлеты-обрабатывают-фильтры)
10. [Как сервлеты обрабатывают ошибки?](#10-как-сервлеты-обрабатывают-ошибки)
11. [Как сервлеты взаимодействуют с JSP?](#11-как-сервлеты-взаимодействуют-с-jsp)
12. [Как обеспечить потокобезопасность сервлетов?](#12-как-обеспечить-потокобезопасность-сервлетов)
13. [Как сервлеты обрабатывают загрузку файлов?](#13-как-сервлеты-обрабатывают-загрузку-файлов)
14. [Как сервлеты поддерживают RESTful API?](#14-как-сервлеты-поддерживают-restful-api)
15. [Как сервлеты работают с WebSocket?](#15-как-сервлеты-работают-с-websocket)
16. [Как оптимизировать производительность сервлетов?](#16-как-оптимизировать-производительность-сервлетов)
17. [Как обеспечить безопасность сервлетов?](#17-как-обеспечить-безопасность-сервлетов)
18. [Что такое контейнер сервлетов и какова его основная функция?](#18-что-такое-контейнер-сервлетов-и-какова-его-основная-функция)
19. [Как контейнер сервлетов управляет жизненным циклом сервлета?](#19-как-контейнер-сервлетов-управляет-жизненным-циклом-сервлета)
20. [Как контейнер сервлетов обрабатывает HTTP-запросы?](#20-как-контейнер-сервлетов-обрабатывает-http-запросы)
21. [Какие компоненты предоставляет контейнер сервлетов?](#21-какие-компоненты-предоставляет-контейнер-сервлетов)
22. [Как контейнер сервлетов поддерживает конфигурацию приложения?](#22-как-контейнер-сервлетов-поддерживает-конфигурацию-приложения)
23. [Как контейнер сервлетов обеспечивает многопоточность?](#23-как-контейнер-сервлетов-обеспечивает-многопоточность)
24. [Как контейнер сервлетов поддерживает масштабируемость?](#24-как-контейнер-сервлетов-поддерживает-масштабируемость)
25. [Какие дополнительные возможности предоставляют контейнеры?](#25-какие-дополнительные-возможности-предоставляют-контейнеры)
26. [Как выбрать контейнер сервлетов для проекта?](#26-как-выбрать-контейнер-сервлетов-для-проекта)
27. [Как контейнер сервлетов обрабатывает ресурсы и их освобождение?](#27-как-контейнер-сервлетов-обрабатывает-ресурсы-и-их-освобождение)

---

## Сервлеты

### 1. Что такое сервлет и какова его роль в веб-приложении?

Сервлет — это Java-класс, реализующий интерфейс `javax.servlet.Servlet`, для обработки HTTP-запросов и формирования ответов в веб-приложениях. Работает в контейнере сервлетов (например, Tomcat, Jetty), генерируя динамический контент (HTML, JSON).

**Роль**:
- Обработка GET, POST и других HTTP-запросов.
- Формирование динамических веб-страниц или API-ответов.

**Нюанс**: Обычно используется `HttpServlet` для HTTP-запросов.

[Назад к оглавлению](#оглавление)

---

### 2. Как работает жизненный цикл сервлета?

Жизненный цикл сервлета включает три этапа:
1. **Инициализация**: Вызов `init(ServletConfig config)` для настройки ресурсов.
2. **Обработка запросов**: Вызов `service(ServletRequest req, ServletResponse res)` для каждого запроса.
3. **Уничтожение**: Вызов `destroy()` для освобождения ресурсов.

**Нюанс**:
- `init` вызывается один раз.
- Аннотация `@WebServlet(loadOnStartup)` управляет моментом инициализации.

[Назад к оглавлению](#оглавление)

---

### 3. Как настроить сервлет в веб-приложении?

Сервлеты настраиваются двумя способами:
1. **Через `web.xml`**:
   ```xml
   <servlet>
       <servlet-name>MyServlet</servlet-name>
       <servlet-class>com.example.MyServlet</servlet-class>
   </servlet>
   <servlet-mapping>
       <servlet-name>MyServlet</servlet-name>
       <url-pattern>/myServlet</url-pattern>
   </servlet-mapping>
   ```
2. **Через аннотации**:
   ```java
   @WebServlet("/myServlet")
   public class MyServlet extends HttpServlet {}
   ```

**Нюанс**: Аннотации упрощают настройку, но `web.xml` лучше для сложных приложений.

[Назад к оглавлению](#оглавление)

---

### 4. Как сервлеты обрабатывают HTTP-запросы?

Класс `HttpServlet` предоставляет методы для HTTP-запросов:

| Метод       | HTTP-метод | Описание                     |
|-------------|------------|------------------------------|
| `doGet`     | GET        | Получение данных             |
| `doPost`    | POST       | Отправка данных (например, формы) |
| `doPut`     | PUT        | Обновление ресурса           |
| `doDelete`  | DELETE     | Удаление ресурса             |
| `doHead`    | HEAD       | Только заголовки             |
| `doOptions` | OPTIONS    | Доступные методы             |
| `doTrace`   | TRACE      | Диагностика                  |

**Нюанс**:
- Непереопределённые методы возвращают `405 Method Not Allowed`.
- Параметры доступны через `request.getParameter()`.

[Назад к оглавлению](#оглавление)

---

### 5. Как сервлеты взаимодействуют с параметрами и атрибутами запроса?

- **Параметры**: Передаются через URL (GET) или тело (POST). Доступ: `request.getParameter(String name)`.
- **Атрибуты**: Устанавливаются через `request.setAttribute(String name, Object value)`.

**Нюанс**:
- Параметры только для чтения.
- Для загрузки файлов требуется `@MultipartConfig`.

[Назад к оглавлению](#оглавление)

---

### 6. Что такое `ServletContext` и как он используется?

`ServletContext` — глобальный контекст веб-приложения, доступный через `getServletContext()`.

**Применение**:
- Хранение конфигурации.
- Доступ к параметрам: `getInitParameter`.
- Работа с файлами: `getResourceAsStream`.

**Нюанс**: Не потокобезопасен, требует синхронизации.

[Назад к оглавлению](#оглавление)

---

### 7. Как работает сессия в сервлетах?

Сессия создаётся через `request.getSession()` и использует `JSESSIONID`.

**Возможности**:
- Хранение данных: `session.setAttribute`.
- Время жизни: `session.setMaxInactiveInterval`.
- Инвалидация: `session.invalidate`.

**Нюанс**:
- Поддерживает URL rewriting, если cookies отключены.
- Используйте `HttpOnly` и `Secure` для безопасности.

[Назад к оглавлению](#оглавление)

---

### 8. Как сервлеты поддерживают асинхронную обработку?

Сервлеты 3.0+ поддерживают асинхронность через `asyncSupported=true` и `request.startAsync()`.

**Пример**:
```java
@WebServlet(value="/async", asyncSupported=true)
public class AsyncServlet extends HttpServlet {
    protected void doGet(HttpServletRequest req, HttpServletResponse res) {
        AsyncContext async = req.startAsync();
        async.start(() -> {
            // Длительная операция
            async.complete();
        });
    }
}
```

**Нюанс**: Освобождает потоки контейнера, улучшая масштабируемость.

[Назад к оглавлению](#оглавление)

---

### 9. Как сервлеты обрабатывают фильтры?

Фильтры перехватывают запросы/ответы через `javax.servlet.Filter`.

**Пример**:
```java
@WebFilter("/myServlet")
public class MyFilter implements Filter {
    public void doFilter(ServletRequest req, ServletResponse res, FilterChain chain) {
        chain.doFilter(req, res);
    }
}
```

**Нюанс**: Порядок фильтров задаётся в `web.xml` или аннотациях.

[Назад к оглавлению](#оглавление)

---

### 10. Как сервлеты обрабатывают ошибки?

Ошибки обрабатываются через:
- **web.xml**:
  ```xml
  <error-page>
      <error-code>404</error-code>
      <location>/error404.jsp</location>
  </error-page>
  ```
- `try-catch` в методах сервлета.

**Нюанс**: Используйте `response.sendError` для HTTP-ошибок.

[Назад к оглавлению](#оглавление)

---

### 11. Как сервлеты взаимодействуют с JSP?

Сервлеты передают данные в JSP через `request.setAttribute` и `RequestDispatcher`.

**Пример**:
```java
request.setAttribute("data", "value");
request.getRequestDispatcher("page.jsp").forward(req, res);
```

**Нюанс**: JSP компилируется в сервлеты, но лучше для UI, а сервлеты — для логики.

[Назад к оглавлению](#оглавление)

---

### 12. Как обеспечить потокобезопасность сервлетов?

- Избегайте изменяемых полей.
- Используйте локальные переменные.
- Синхронизируйте общие ресурсы.

**Нюанс**: `SingleThreadModel` устарел.

[Назад к оглавлению](#оглавление)

---

### 13. Как сервлеты обрабатывают загрузку файлов?

Используется `@MultipartConfig`.

**Пример**:
```java
@WebServlet("/upload")
@MultipartConfig
public class UploadServlet extends HttpServlet {
    protected void doPost(HttpServletRequest request, HttpServletResponse response) {
        Part filePart = request.getPart("file");
    }
}
```

**Нюанс**: Ограничивайте размер файлов через `maxFileSize`.

[Назад к оглавлению](#оглавление)

---

### 14. Как сервлеты поддерживают RESTful API?

Сервлеты возвращают JSON/XML для API.

**Пример**:
```java
@WebServlet("/api/user")
public class UserApiServlet extends HttpServlet {
    protected void doGet(HttpServletRequest request, HttpServletResponse response) {
        response.setContentType("application/json");
        response.getWriter().print("{\"name\": \"John\"}");
    }
}
```

**Нюанс**: Используйте Jackson для сериализации.

[Назад к оглавлению](#оглавление)

---

### 15. Как сервлеты работают с WebSocket?

WebSocket поддерживается через `javax.websocket`.

**Пример**:
```java
@ServerEndpoint("/websocket")
public class MyWebSocket {
    @OnMessage
    public void onMessage(String message, Session session) {
        session.getBasicRemote().sendText("Response: " + message);
    }
}
```

**Нюанс**: Требует конфигурации сервера.

[Назад к оглавлению](#оглавление)

---

### 16. Как оптимизировать производительность сервлетов?

- Кэшируйте статические ресурсы.
- Используйте асинхронную обработку.
- Применяйте пулы соединений (HikariCP).
- Включите GZIP.

**Нюанс**: Чрезмерное кэширование может устаревать данные.

[Назад к оглавлению](#оглавление)

---

### 17. Как обеспечить безопасность сервлетов?

- Аутентификация через фильтры.
- HTTPS с SSL/TLS.
- CSRF-токены.
- Экранирование ввода.

**Нюанс**: Добавляйте заголовок `X-Content-Type-Options: nosniff`.

[Назад к оглавлению](#оглавление)

---

## Контейнеры сервлетов

### 18. Что такое контейнер сервлетов и какова его основная функция?

Контейнер сервлетов — серверное ПО для выполнения сервлетов и JSP. Примеры: Tomcat, Jetty.

**Функция**: Управление жизненным циклом, маршрутизация запросов, поддержка HTTP.

**Нюанс**: Реализует Jakarta Servlet API.

[Назад к оглавлению](#оглавление)

---

### 19. Как контейнер сервлетов управляет жизненным циклом сервлета?

- Загружает класс и создаёт экземпляр.
- Вызывает `init` для настройки.
- Направляет запросы в `service`.
- Вызывает `destroy` при выгрузке.

**Нюанс**: Один экземпляр сервлета для всех запросов.

[Назад к оглавлению](#оглавление)

---

### 20. Как контейнер сервлетов обрабатывает HTTP-запросы?

1. Получает запрос.
2. Сопоставляет URL с сервлетом.
3. Создаёт `HttpServletRequest`/`HttpServletResponse`.
4. Применяет фильтры.
5. Отправляет ответ.

**Нюанс**: Использует пул потоков.

[Назад к оглавлению](#оглавление)

---

### 21. Какие компоненты предоставляет контейнер сервлетов?

- `ServletContext`
- `HttpSession`
- `RequestDispatcher`
- Фильтры
- Слушатели

**Нюанс**: `ServletContext` не потокобезопасен.

[Назад к оглавлению](#оглавление)

---

### 22. Как контейнер сервлетов поддерживает конфигурацию приложения?

Читает `web.xml` или аннотации (`@WebServlet`, `@WebFilter`).

**Нюанс**: Аннотации сканируются при старте, если `metadata-complete=false`.

[Назад к оглавлению](#оглавление)

---

### 23. Как контейнер сервлетов обеспечивает многопоточность?

Создаёт пул потоков, каждый запрос обрабатывается отдельным потоком.

**Нюанс**: Требуется потокобезопасность сервлетов.

[Назад к оглавлению](#оглавление)

---

### 24. Как контейнер сервлетов поддерживает масштабируемость?

- Пул потоков.
- Кластеризация сессий.
- Асинхронная обработка.
- Кэширование.

**Нюанс**: Требуется сериализация объектов для кластеризации.

[Назад к оглавлению](#оглавление)

---

### 25. Какие дополнительные возможности предоставляют контейнеры?

- JNDI для ресурсов.
- Пулы соединений.
- Мониторинг (JMX).
- Горячее переразвертывание.

**Нюанс**: Горячее переразвертывание может вызывать утечки памяти.

[Назад к оглавлению](#оглавление)

---

### 26. Как выбрать контейнер сервлетов для проекта?

| Контейнер  | Преимущества                     | Использование                   |
|------------|----------------------------------|---------------------------------|
| **Tomcat** | Лёгкий, популярный              | Веб-приложения                  |
| **Jetty**  | Компактный, для встраивания     | Асинхронные приложения          |
| **GlassFish** | Полный Jakarta EE            | Сложные проекты                 |
| **Payara** | Современная поддержка           | Альтернатива GlassFish          |

**Нюанс**: Проверьте версию Servlet API.

[Назад к оглавлению](#оглавление)

---

### 27. Как контейнер сервлетов обрабатывает ресурсы и их освобождение?

- Использует `ServletContextListener` для инициализации/очистки.
- Вызывает `destroy` сервлета.
- Полагает на JVM для гарбаж-коллекции.

**Нюанс**: Используйте `try-with-resources` для JDBC.

[Назад к оглавлению](#оглавление)