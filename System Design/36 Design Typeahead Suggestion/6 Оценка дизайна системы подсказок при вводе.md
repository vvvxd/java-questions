# Оценка дизайна системы подсказок при вводе

Оцените дизайн системы подсказок при вводе на основе нефункциональных требований системы.

## Выполнение требований

Нефункциональными требованиями предлагаемой системы подсказок при вводе являются низкая задержка, отказоустойчивость и масштабируемость.

*   **Низкая задержка:** Существуют различные уровни, на которых мы можем минимизировать задержку системы. Мы можем минимизировать задержку с помощью следующих опций:
    *   Уменьшение глубины дерева, что сокращает общее время обхода.
    *   Обновление префиксного дерева (trie) в офлайн-режиме, что означает, что время, затрачиваемое на операцию обновления, не находится на критическом пути для клиентов.
    *   Использование географически распределенных приложений и серверов баз данных. Таким образом, услуга предоставляется ближе к пользователю, что также сокращает любые задержки связи и помогает уменьшить общую задержку.
    *   Использование Redis в качестве кэширующего слоя поверх кластеров баз данных NoSQL и базы данных Cassandra для обеспечения низко-латентного извлечения данных и улучшения производительности.
    *   Правильное разделение (партиционирование) префиксных деревьев, что приводит к правильному распределению нагрузки и улучшению производительности.

*   **Отказоустойчивость:** Поскольку предусмотрена репликация и разделение деревьев, система работает с высокой степенью отказоустойчивости. Если один сервер выходит из строя, другие находятся в режиме ожидания для предоставления услуг.

*   **Масштабируемость:** Поскольку наша предлагаемая система является гибкой, можно добавлять или удалять больше серверов по мере увеличения нагрузки. Например, если количество запросов увеличивается, соответственно увеличивается и количество разделов или шардов деревьев.

#### Подходы для выполнения нефункциональных требований

| Нефункциональные требования | Подходы |
| :--- | :--- |
| Низкая задержка | <ul><li>Уменьшение глубины trie ускоряет обход</li><li>Обновление trie в офлайн-режиме (не в реальном времени)</li><li>Разделение trie</li><li>Кэширующие серверы</li></ul> |
| Отказоустойчивость | <ul><li>Репликация trie и баз данных NoSQL</li></ul> |
| Масштабируемость | <ul><li>Добавление или удаление серверов приложений в зависимости от входящего трафика</li><li>Увеличение количества разделов trie</li></ul> |

## Оптимизация на стороне клиента

Для улучшения пользовательского опыта мы можем реализовать следующие оптимизации на стороне клиента:

*   Клиент должен пытаться связаться с сервером только в том случае, если пользователь не нажимал никаких клавиш в течение некоторого времени — например, при любой задержке более 160 мс, что является средней задержкой между двумя нажатиями клавиш. Таким образом, мы также можем избежать ненужного потребления пропускной способности. Это предложение может быть не полезно, когда пользователь печатает быстро.
*   Клиент может сначала подождать, пока пользователь введет несколько символов.
*   Клиенты могут сохранять локальную копию недавней истории предложений. Уровень повторного использования недавней истории в списке предложений относительно высок.
*   Одним из самых важных элементов является установление соединения с сервером как можно скорее. Клиент может установить соединение с сервером, как только пользователь посещает страницу поиска. В результате клиент не тратит время на установление соединения, когда пользователь вводит первый символ. Обычно соединение с сервером устанавливается по **протоколу WebSocket**.
*   Для эффективности сервер может передавать часть своего кэша в CDN и другие пограничные кэши в точках обмена интернет-трафиком (IXP) или даже внутри сети интернет-провайдера (ISP) клиента.

## Персонализация

Пользователи получают подсказки на основе их предыдущих поисков, местоположения, языка и других факторов. Мы можем сохранять личную историю каждого пользователя на сервере отдельно и кэшировать ее на клиенте. Перед отправкой окончательного набора пользователю сервер может включить эти персонализированные фразы. Персонализированные поиски всегда должны иметь приоритет над другими типами поисков.

## Итоги

В этой задаче по проектированию мы узнали, как перенос ресурсоемкой обработки в офлайн-инфраструктуру и использование подходящих структур данных позволяют нам обслуживать наших клиентов с низкой задержкой. Многие оптимизации подходят для конкретных сценариев использования. Мы рассмотрели несколько оптимизаций наших структур данных trie для компактного хранения данных и быстрой выдачи.
