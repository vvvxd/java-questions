# Основы веб-безопасности: что нужно знать

## 1. Триада CIA: основа безопасности

Триада CIA — это три кита, на которых держится информационная безопасность: **Конфиденциальность**, **Целостность** и **Доступность**. Эти принципы помогают защищать данные и системы, а также оценивать, насколько хорошо вы справляетесь с безопасностью.

### Конфиденциальность: только для своих
**Что это?**  
Конфиденциальность — это когда доступ к информации есть только у тех, кому он положен. Никто посторонний не должен подсмотреть ваши данные.

**Зачем это нужно?**  
Чтобы личные данные, финансовые сведения или коммерческие секреты не попали в чужие руки.

**Примеры:**
- Пароли хранятся в зашифрованном виде, чтобы их не смогли украсть, даже если база данных попадет к хакерам.
- Данные передаются по HTTPS, а не по HTTP, чтобы их не перехватили в пути.
- Доступ к медицинским данным есть только у врачей и пациентов.

**Чем это грозит?**
- Перехват данных (например, атака "человек посередине").
- Утечка из-за слабого контроля доступа.
- Фишинг или социальная инженерия, когда вас обманом заставляют выдать данные.

**Как защититься?**
- **Шифрование**: Используйте сильные алгоритмы, например AES-256 для данных на диске и TLS 1.3 для передачи.
- **Контроль доступа**: Настройте роли (RBAC) и дайте каждому только те права, которые ему нужны.
- **Аутентификация**: Включите двухфакторку (MFA) и требуйте надежные пароли.
- **Обучение**: Учите сотрудников, как не попасться на фишинг.

**Связь с OWASP Top 10:**
- A02:2021 (Криптографические сбои): слабое шифрование = утечка данных.
- A01:2021 (Нарушение контроля доступа): плохая настройка прав открывает двери хакерам.

### Целостность: данные без подделок
**Что это?**  
Целостность — это уверенность, что данные не подделаны, не испорчены и остаются такими, какими должны быть.

**Зачем это нужно?**  
Чтобы данные были точными и надежными. Если кто-то изменит, например, банковские реквизиты, это может стать катастрофой.

**Примеры:**
- Хеш-функции (например, SHA-256) помогают убедиться, что файл не был изменен.
- Защита базы данных от SQL-инъекций, чтобы никто не подделал записи.
- Цифровые подписи подтверждают, что обновление ПО пришло от разработчика.

**Чем это грозит?**
- SQL-инъекции, которые портят данные в базе.
- Подмена данных в пути (например, изменение номера счета).
- Ошибки из-за неправильной обработки данных.

**Как защититься?**
- **Хеширование и подписи**: Используйте SHA-256 или ECDSA для проверки целостности.
- **Контроль версий**: Следите за изменениями с помощью систем вроде Git.
- **Проверка ввода**: Все, что вводят пользователи, проверяйте на сервере.
- **Резервные копии**: Регулярно делайте бэкапы, чтобы восстановить данные, если что-то пошло не так.

**Связь с OWASP Top 10:**
- A03:2021 (Инъекции): вредоносный ввод ломает целостность данных.
- A08:2021 (Сбои целостности): непроверенные обновления могут подставить систему.

### Доступность: всё работает, когда нужно
**Что это?**  
Доступность — это когда нужные данные и сервисы всегда под рукой для тех, кому они положены. Никаких сбоев и простоев.

**Зачем это нужно?**  
Чтобы бизнес не останавливался, а пользователи могли работать с сайтом или приложением без перебоев.

**Примеры:**
- Защита от DDoS-атак, чтобы сайт не "лег" под наплывом запросов.
- Резервные серверы на случай, если основной выйдет из строя.
- Регулярные обновления, чтобы закрыть дыры, из-за которых система может зависнуть.

**Чем это грозит?**
- DDoS-атаки, которые перегружают сервер.
- Вымогатели (ransomware), блокирующие доступ к данным.
- Сбои из-за устаревшего ПО или железа.

**Как защититься?**
- **Анти-DDoS**: Используйте Cloudflare или AWS Shield для защиты от атак.
- **Резервирование**: Настройте кластеры и балансировщики нагрузки.
- **Мониторинг**: Следите за системой с помощью инструментов вроде Prometheus.
- **Обновления**: Регулярно патчите ПО, чтобы закрывать уязвимости.

**Связь с OWASP Top 10:**
- A06:2021 (Устаревшие компоненты): старое ПО — легкая мишень для атак.
- A09:2021 (Сбои мониторинга): без логов и алертов атаки замечают слишком поздно.

---

## 2. Главные уязвимости: OWASP Top 10

### Что такое OWASP и OWASP Top 10?
**OWASP** (Open Web Application Security Project) — это сообщество, которое помогает делать веб-приложения безопаснее. Они пишут гайды, создают инструменты и делятся знаниями.

**OWASP Top 10** — это список самых опасных и частых уязвимостей веб-приложений. Он обновляется раз в несколько лет (последняя версия — 2021) и помогает разработчикам, тестировщикам и бизнесу понять, на что обратить внимание в первую очередь. Это не полный список всех угроз, а скорее гид по самым критичным проблемам.

---

### A01:2021 — Нарушение контроля доступа
**Что это?**  
Когда пользователь получает доступ к тому, к чему не должен. Это самая частая уязвимость, потому что её легко упустить и использовать.

**Как это выглядит?**  
Представьте, что у вас есть ключ от номера в отеле, но он почему-то открывает и чужие номера, и даже кабинет менеджера.

**Как это работает?**
- **IDOR (Insecure Direct Object Reference)**: В URL стоит `id=123`, пользователь меняет на `id=124` и видит чужие данные, потому что сервер не проверяет права.
- **Доступ к админке**: Пользователь вводит `example.com/admin` и попадает в админ-панель, потому что её не защитили.
- **Повышение привилегий**: Обычный пользователь находит способ выполнить действия админа, например, через скрытый API.

**Что будет?**  
Утечка данных, их изменение или удаление, а в худшем случае — полный захват системы.

**Как защититься?**
- Запрещайте доступ ко всему по умолчанию, разрешайте только то, что нужно.
- Проверяйте права на сервере, а не только в интерфейсе (скрытая кнопка — не защита).
- Используйте сложные идентификаторы, например UUID, вместо простых чисел (1, 2, 3...).

---

### A02:2021 — Криптографические сбои
**Что это?**  
Проблемы с шифрованием или его отсутствие. Это когда данные, которые должны быть защищены, оказываются уязвимыми.

**Как это выглядит?**  
Вы отправляете письмо с номером карты на открытке, которую может прочитать любой. Или кладете данные в сейф, а код от него пишете на дверце.

**Как это работает?**
- Пароли хранятся в открытом виде или с устаревшими алгоритмами вроде MD5.
- Данные передаются по HTTP, а не HTTPS.
- Используются слабые алгоритмы шифрования (например, DES).
- Ключи шифрования "зашиты" в коде приложения.

**Что будет?**  
Утечка данных, взлом аккаунтов, финансовые и репутационные потери.

**Как защититься?**
- Включите HTTPS для всего сайта.
- Хешируйте пароли с помощью современных алгоритмов (bcrypt, Argon2).
- Используйте проверенные алгоритмы шифрования (AES-256).
- Храните ключи безопасно, например, в Key Vault.

---

### A03:2021 — Инъекции
**Что это?**  
Злоумышленник отправляет приложению вредоносные данные, которые оно принимает за команду. Это целая группа уязвимостей.

**Как это выглядит?**  
Вы просите секретаря найти папку «Иванов», а вместо этого говорите: «Найди папку "Иванов" и удали весь архив». Если секретарь не проверяет, он всё выполнит.

**Как это работает?**
- **SQL-инъекция**: В поле логина вводят `' OR 1=1 --`, и сервер пропускает без пароля.
- **XSS (Cross-Site Scripting)**: В комментарий вставляют `<script>alert('Hacked')</script>`, и код выполняется в браузере другого пользователя.
- **Командные инъекции**: Через уязвимость в приложении запускают команды операционной системы.

**Что будет?**  
Кража данных, обход паролей, захват сервера или выполнение действий от имени другого пользователя.

**Как защититься?**
- Используйте параметризованные запросы для баз данных.
- Проверяйте, что вводит пользователь, и фильтруйте всё подозрительное.
- Экранируйте специальные символы (`<`, `>`) перед выводом на страницу.

---

### A04:2021 — Небезопасный дизайн
**Что это?**  
Когда уязвимость заложена в самой архитектуре приложения, а не в коде. Безопасность просто не продумали на старте.

**Как это выглядит?**  
Вы строите банк с супернадежной дверью, но стены — из картона. Дверь крепкая, а вот дизайн провальный.

**Как это работает?**
- Форма сброса пароля требует только логин, и злоумышленник может массово запрашивать сброс для всех пользователей.
- Нет ограничений на добавление товаров в корзину — можно "положить" миллиард и обрушить сервер.
- Нет защиты от брутфорса — можно бесконечно подбирать пароли.

**Что будет?**  
Уязвимости, которые сложно и дорого исправлять, потому что они в самой основе системы.

**Как защититься?**
- Проводите моделирование угроз (Threat Modeling) на этапе проектирования.
- Включайте безопасность с самого начала разработки (принцип Shift Left).
- Используйте проверенные шаблоны проектирования.

---

### A05:2021 — Неправильная настройка
**Что это?**  
Ошибки в настройке серверов, баз данных или облачных сервисов. Часто это настройки по умолчанию, которые забыли поменять.

**Как это выглядит?**  
Вы ставите крутую систему видеонаблюдения, но оставляете логин `admin` и пароль `admin`. И окно открытым.

**Как это работает?**
- Веб-сервер показывает список файлов в папке, потому что включили листинг директорий.
- Ошибки выдают слишком много информации: пути к файлам, SQL-запросы.
- Облачное хранилище (например, S3) случайно сделали общедоступным.
- Оставили учетки по умолчанию, которые легко взломать.

**Что будет?**  
Утечка данных, несанкционированный доступ или полный захват системы.

**Как защититься?**
- "Укрепляйте" системы: отключайте ненужные функции, закрывайте лишние порты.
- Настройте кастомные страницы ошибок, чтобы они не выдавали лишнего.
- Используйте инструменты для проверки конфигураций.

---

### A06:2021 — Устаревшие компоненты
**Что это?**  
Использование старых библиотек, фреймворков или ПО с известными уязвимостями. Большая часть кода в приложениях — это сторонние компоненты.

**Как это выглядит?**  
Вы строите дом из кирпичей, которые, как все знают, трескаются под нагрузкой.

**Как это работает?**
- Приложение использует старую версию `log4j` с уязвимостью Log4Shell.
- Фронтенд работает на старом jQuery, где есть XSS-уязвимости.
- Сервер на устаревшем PHP или Apache, для которых есть готовые эксплойты.

**Что будет?**  
От утечки данных до полного захвата сервера — зависит от уязвимости.

**Как защититься?**
- Ведите учет всех библиотек и их версий.
- Используйте сканеры вроде `npm audit` или OWASP Dependency-Check.
- Регулярно обновляйте всё, что можно.

---

### A07:2021 — Сбои аутентификации
**Что это?**  
Проблемы с проверкой, кто вы, и управлением вашей сессией.

**Как это выглядит?**  
Охранник пускает в здание всех, кто говорит: "Я тут работаю", не проверяя пропуск. А пропуска, которые он выдает, действуют вечно.

**Как это работает?**
- Разрешены слабые пароли вроде `123456`.
- Нет защиты от брутфорса или атак с украденными паролями.
- ID сессии легко угадать, и он не меняется после входа.

**Что будет?**  
Взлом аккаунтов, включая админские.

**Как защититься?**
- Включите двухфакторную аутентификацию (MFA).
- Требуйте сложные пароли.
- Ограничивайте попытки входа и блокируйте подозрительные аккаунты.
- Используйте длинные и случайные ID сессий.

---

### A08:2021 — Нарушение целостности
**Что это?**  
Проблемы с проверкой целостности кода или данных. Например, когда обновления или данные приходят из ненадежных источников.

**Как это выглядит?**  
Вы качаете обновление с официального сайта, но по пути его подменяют на вирус. А ваша система не проверяет, что файл настоящий.

**Как это работает?**
- Приложение десериализует данные из ненадежного источника и выполняет вредоносный код.
- Зависимости качаются из скомпрометированного репозитория.
- Хакер вмешивается в CI/CD и внедряет свой код в приложение.

**Что будет?**  
От выполнения вредоносного кода до полного захвата системы.

**Как защититься?**
- Проверяйте цифровые подписи всех обновлений и библиотек.
- Защищайте CI/CD-конвейер.
- Не десериализуйте данные из непроверенных источников.

---

### A09:2021 — Проблемы с логированием и мониторингом
**Что это?**  
Когда атаки не замечают из-за плохих логов или их отсутствия.

**Как это выглядит?**  
В банке ограбление, но камеры не работают, а сигнализация отключена. Никто не знает, что украли и кто.

**Как это работает?**
- Важные события (входы, ошибки) не записываются.
- Логи хранятся локально и легко стираются хакером.
- Нет алертов о подозрительной активности, например, о сотне попыток входа за минуту.

**Что будет?**  
Атака может идти месяцами, а вы не узнаете. Расследовать тоже не получится.

**Как защититься?**
- Логируйте все важные события.
- Используйте защищенные системы логирования (SIEM).
- Настройте алерты на подозрительные действия.

---

### A10:2021 — Подделка запросов на стороне сервера (SSRF)
**Что это?**  
Злоумышленник заставляет сервер отправить запрос туда, куда ему не положено.

**Как это выглядит?**  
Вы просите робота-курьера принести документ из архива, а вместо номера документа даете адрес секретного сервера. Робот послушно идет туда и приносит всё, что нашел.

**Как это работает?**
- Приложение делает скриншот сайта по URL. Хакер подсовывает внутренний адрес (`http://192.168.0.1/admin`), и сервер выдает админ-панель.
- Атака на метаданные облака (`http://169.254.169.254/...`) крадет ключи доступа.

**Что будет?**  
Доступ к внутренним сервисам, утечка данных, обход файрволов.

**Как защититься?**
- Разрешайте серверу обращаться только к проверенным доменам и IP.
- Проверяйте URL, которые дает пользователь.
- Изолируйте внутренние ресурсы от внешнего интерфейса сервера.

---

### Что такое CSRF?
**CSRF (Cross-Site Request Forgery)** — это когда хакер заставляет ваш браузер выполнить действие на сайте, где вы уже залогинены, без вашего ведома.

**Как это выглядит?**  
Вы — босс, а ваш браузер — доверчивый помощник с пропуском в банк. Вот что происходит:
1. Вы логинитесь в банке (`my-bank.com`), и браузер получает "пропуск" (cookie).
2. Потом открываете в новой вкладке сайт хакера (`evil-blog.com`).
3. На этом сайте спрятан код, который говорит браузеру: "Иди в банк и переведи 1000$ на счет хакера".
4. Браузер видит ваш пропуск и выполняет команду, а банк думает, что это вы.

**Ключевой момент**: Хакер не крадет ваши данные, он просто использует ваш браузер, чтобы сделать что-то от вашего имени.

**Как защищаются?**  
Современные фреймворки (Django, Rails, Laravel) включают защиту от CSRF по умолчанию. Самый популярный способ — **Anti-CSRF токены**:
- Сервер создает уникальный токен для каждой формы (например, перевода денег).
- Токен отправляется с формой и проверяется на сервере.
- Хакер не может угадать токен, и его поддельный запрос не пройдет.

Благодаря встроенной защите CSRF-атаки стали редкостью.

---

## 3. Защита на всех уровнях: Defense in Depth

### 1. Same-Origin Policy (SOP): браузер на страже
**Что это?**  
SOP — это правило в браузерах, которое не дает скриптам с одного сайта лезть на другой. Это как забор, который защищает ваши данные от чужаков.

**Что такое origin?**  
Origin — это комбинация протокола (`http` или `https`), домена (`example.com`) и порта (`80` или `443`). Например:
- `https://example.com` и `https://example.com:443` — один origin.
- `http://example.com` и `https://example.com` — разные (протокол разный).
- `https://sub.example.com` и `https://example.com` — тоже разные (хосты разные).

**Как это работает?**
- Скрипт с `https://example.com` не может отправить запрос на `https://other.com` или прочитать данные оттуда без разрешения.
- Это защищает от XSS и CSRF, когда хакер пытается украсть данные через ваш браузер.

**Что ограничивает?**
- Запросы через `XMLHttpRequest` или `Fetch API` блокируются, если origin другой.
- Cookies, iframe и другие ресурсы тоже под SOP.
- Но картинки, скрипты и CSS грузятся с других сайтов, хотя их содержимое скриптам недоступно.

**Проблемы и обход:**
- Для обмена данными между сайтами есть CORS (см. ниже) или устаревший JSONP.
- Хакеры могут обойти SOP через XSS, так что важно всё правильно настраивать.

---

### 2. CORS: делимся данными безопасно
**CORS (Cross-Origin Resource Sharing)** — это способ разрешить сайтам обмениваться данными, несмотря на SOP, но под контролем.

**Как это работает?**
- Браузер отправляет запрос с заголовком `Origin`, показывая, с какого сайта он пришел.
- Сервер отвечает заголовками, которые разрешают или запрещают доступ:
  - `Access-Control-Allow-Origin`: какие сайты могут получить данные (например, `https://example.com` или `*` для всех).
  - `Access-Control-Allow-Methods`: какие методы разрешены (`GET`, `POST`).
  - `Access-Control-Allow-Headers`: какие заголовки можно отправлять.
  - `Access-Control-Allow-Credentials`: можно ли отправлять cookie.

**Пример:**
1. Сайт `https://client.com` запрашивает данные с `https://api.com`.
2. Браузер добавляет `Origin: https://client.com`.
3. Сервер отвечает: `Access-Control-Allow-Origin: https://client.com`.
4. Если доступ разрешен, браузер дает скрипту обработать ответ. Если нет — блокирует.

**Preflight-запросы:**
Для сложных запросов (например, `PUT`) браузер сначала отправляет запрос `OPTIONS`, чтобы спросить у сервера, можно ли. Сервер должен ответить нужными заголовками.

**Проблемы:**
- Если поставить `Access-Control-Allow-Origin: *` с поддержкой cookies, это создаст уязвимость.
- CORS не защищает от CSRF, так как запросы всё равно могут отправляться.

---

### 3. Content Security Policy (CSP): контроль ресурсов
**CSP** — это инструмент, который решает, какие скрипты, стили и другие ресурсы можно загружать на страницу. Это как фильтр, защищающий от XSS.

**Как это работает?**
- CSP задается через заголовок `Content-Security-Policy` или тег `<meta>`.
- Указывает, какие источники доверенные для скриптов, стилей, картинок и т.д.
- Пример:
  ```http
  Content-Security-Policy: default-src 'self'; script-src 'self' https://trusted.com; style-src 'self';
  ```
  - `default-src 'self'`: всё грузится только с текущего сайта.
  - `script-src 'self' https://trusted.com`: скрипты только с текущего сайта и `trusted.com`.
  - `style-src 'self'`: стили только с текущего сайта.

**Что умеет CSP?**
- Ограничивает, откуда грузятся ресурсы.
- Запрещает inline-скрипты (`<script>`) и стили в HTML, требуя внешние файлы.
- Поддерживает nonce (уникальные коды) или хэши для безопасных inline-скриптов.
- Может отправлять отчеты о нарушениях, не блокируя их (режим report-only).

**Пример защиты от XSS:**
Без CSP хакер может внедрить `<script>alert('XSS')</script>`. С CSP, где разрешены только скрипты с `'self'`, такой код не сработает.

**Проблемы:**
- Слишком строгие настройки могут сломать сайт.
- Работает только в современных браузерах.
- Не защищает от атак вроде CSRF, если они не связаны с ресурсами.

---

## Тестирование безопасности: как найти уязвимости

### 1. SAST: проверяем код
**Что это?**  
SAST (Static Application Security Testing) — это когда вы проверяете исходный код приложения, не запуская его. Инструменты ищут уязвимости вроде инъекций или слабого шифрования.

**Как это работает?**
- Смотрит код, его структуру или байт-код.
- Ищет подозрительные паттерны, например, небезопасные функции или отсутствие проверок.
- Используется на этапе разработки или в CI/CD.

**Что находит?**
- SQL-инъекции (A03:2021).
- Проблемы с обработкой пользовательского ввода.
- Устаревшие криптографические функции (A02:2021).

**Плюсы:**
- Находит уязвимости еще до запуска приложения.
- Не нужна тестовая среда.
- Проверяет весь код, даже редко используемый.
- Легко встраивается в CI/CD.

**Минусы:**
- Может выдавать ложные срабатывания.
- Не видит проблем с конфигурацией или поведением приложения.
- Не ловит ошибки, которые появляются только во время работы.

**Инструменты:**
- **SonarQube**: ищет баги и уязвимости в коде на разных языках.
- **Checkmarx**: мощный анализ кода для больших проектов.
- **Fortify**: подходит для крупных приложений.
- **Semgrep**: легкий и гибкий инструмент для поиска паттернов.

**Пример:**  
SonarQube в CI/CD находит строчку `String query = "SELECT * FROM users WHERE id = " + userId;` и советует заменить её на параметризованный запрос.

---

### 2. DAST: атакуем приложение
**Что это?**  
DAST (Dynamic Application Security Testing) — это тестирование работающего приложения, как если бы вы были хакером. Инструменты отправляют вредоносные запросы и смотрят, что получится.

**Как это работает?**
- Тестирует приложение через HTTP-запросы, как настоящий злоумышленник.
- Анализирует ответы сервера на уязвимости.
- Проводится в тестовой или продакшен-подобной среде.

**Что находит?**
- XSS (A03:2021).
- Проблемы с настройкой безопасности (A05:2021).
- SSRF (A10:2021).

**Плюсы:**
- Ловит уязвимости, которые видны только в реальной работе.
- Не нужен доступ к коду.
- Проверяет конфигурацию и сетевые взаимодействия.

**Минусы:**
- Не видит внутренней логики приложения.
- Может пропустить уязвимости в коде, который не выполняется.
- Нужна настроенная тестовая среда.
- Бывают ложные срабатывания.

**Инструменты:**
- **OWASP ZAP**: бесплатный сканер для веб-приложений.
- **Burp Suite**: для ручного и автоматического тестирования.
- **Acunetix**: коммерческий инструмент для сканирования.
- **Netsparker**: точное автоматизированное решение.

**Пример:**  
OWASP ZAP находит XSS в форме, отправляя `<script>alert('XSS')</script>` и видя, что код выполняется в ответе сервера.

---

### 3. SCA: проверяем зависимости
**Что это?**  
SCA (Software Composition Analysis) — это анализ сторонних библиотек и компонентов, которые вы используете. Проверяет, нет ли в них известных уязвимостей или проблем с лицензиями.

**Как это работает?**
- Сканирует файлы вроде `package.json` или `pom.xml`.
- Сравнивает зависимости с базами уязвимостей (CVE, NVD).
- Находит устаревшие версии библиотек.

**Что находит?**
- Уязвимые компоненты (A06:2021).
- Критические баги вроде Log4Shell в Log4j.
- Нарушение лицензий, которые могут вызвать юридические проблемы.

**Плюсы:**
- Быстро находит известные уязвимости.
- Помогает следить за лицензиями.
- Легко встраивается в CI/CD.
- Не требует запущенного приложения.

**Минусы:**
- Проверяет только сторонний код, а не ваш.
- Зависит от актуальности базы уязвимостей.
- Не ловит проблемы в логике или конфигурации.

**Инструменты:**
- **OWASP Dependency-Check**: бесплатный анализ зависимостей.
- **Snyk**: сканирует зависимости и контейнеры.
- **Dependabot**: уведомляет об устаревших библиотеках в GitHub.
- **WhiteSource (Mend)**: коммерческий инструмент для управления зависимостями.
