# Основы веб-безопасности: что нужно знать

# Триада CIA: основа кибербезопасности

Триада CIA — это три столпа, на которых стоит информационная безопасность: **Конфиденциальность**, **Целостность** и **Доступность**. Они помогают защищать данные, системы и оценивать, насколько хорошо вы справляетесь с угрозами.

## Конфиденциальность: только для тех, кому доверяете
 
Конфиденциальность — это когда ваши данные видят только те, кому вы разрешили. Посторонним вход воспрещён.
Чтобы личная информация, финансы или коммерческие тайны не утекли к злоумышленникам.

**Примеры:**
- Пароли хранятся зашифрованными, чтобы хакеры не смогли их вытащить.
- Данные летят по HTTPS, а не по HTTP, чтобы их не перехватили.
- Доступ к медицинским данным есть только у врачей и пациентов.

**Угрозы:**
- Перехват данных (например, атака "человек посередине").
- Утечки из-за слабых настроек доступа.
- Фишинг, когда вас обманом вынуждают раскрыть секреты.

**Как защититься?**
- **Шифрование**: Используйте AES-256 для данных и TLS 1.3 для передачи.
- **Контроль доступа**: Настройте роли (RBAC), чтобы каждый имел минимум прав.
- **Аутентификация**: Включите двухфакторку (MFA) и требуйте сложные пароли.
- **Обучение**: Расскажите команде, как не попасть на удочку фишинга.

**Связь с OWASP Top 10:**
- A02:2021 (Криптографические сбои): слабое шифрование = утечка.
- A01:2021 (Нарушение контроля доступа): плохая настройка прав открывает двери хакерам.

## Целостность: данные без изменений

Целостность — это уверенность, что данные не подделаны, не испорчены и остаются такими, какими вы их оставили.
Чтобы доверять данным. Если кто-то подменит, например, номер счёта в платеже, последствия будут плачевными.

**Примеры:**
- Хеш-функции (например, SHA-256) подтверждают, что файл не трогали.
- Защита от SQL-инъекций не даёт хакерам портить базу данных.
- Цифровые подписи гарантируют, что обновление ПО — от разработчика.

**Угрозы:**
- SQL-инъекции, которые ломают данные.
- Подмена данных в пути (например, смена реквизитов).
- Ошибки из-за неправильной обработки данных.

**Как защититься?**
- **Хеширование и подписи**: Используйте SHA-256 или ECDSA для проверки.
- **Контроль версий**: Следите за изменениями через Git или аналоги.
- **Проверка ввода**: Все пользовательские данные проверяйте на сервере.
- **Бэкапы**: Регулярно сохраняйте копии данных для восстановления.

**Связь с OWASP Top 10:**
- A03:2021 (Инъекции): вредоносный ввод разрушает целостность.
- A08:2021 (Сбои целостности): непроверенные обновления подставляют систему.

## Доступность: всё работает без сбоев
  
Доступность — это когда данные и сервисы всегда под рукой для тех, кому они нужны. Без простоев и лагов.
Чтобы бизнес не вставал, а пользователи могли работать с сайтом или приложением без проблем.

**Примеры:**
- Защита от DDoS-атак, чтобы сайт не "лёг" под шквалом запросов.
- Резервные серверы на случай поломки основного.
- Регулярные патчи, чтобы закрыть уязвимости, из-за которых всё может зависнуть.

**Угрозы:**
- DDoS-атаки, перегружающие сервер.
- Вымогатели (ransomware), блокирующие доступ к данным.
- Сбои из-за старого ПО или железа.

**Как защититься?**
- **Анти-DDoS**: Подключите Cloudflare или AWS Shield.
- **Резервирование**: Настройте кластеры и балансировщики нагрузки.
- **Мониторинг**: Используйте Prometheus или аналоги для слежки за системой.
- **Обновления**: Регулярно патчите ПО, чтобы уязвимости не стали проблемой.

**Связь с OWASP Top 10:**
- A06:2021 (Устаревшие компоненты): старое ПО — мишень для атак.
- A09:2021 (Сбои мониторинга): без логов атаки замечают слишком поздно.

---

## 2. Главные уязвимости: OWASP Top 10

### Что такое OWASP и OWASP Top 10?
**OWASP** (Open Web Application Security Project) — это сообщество, которое помогает делать веб-приложения безопаснее. Они пишут гайды, создают инструменты и делятся знаниями.

**OWASP Top 10** — это список самых опасных и частых уязвимостей веб-приложений. Он обновляется раз в несколько лет (последняя версия — 2021) и помогает разработчикам, тестировщикам и бизнесу понять, на что обратить внимание в первую очередь. Это не полный список всех угроз, а скорее гид по самым критичным проблемам.

---

### A01:2021 — Нарушение контроля доступа
**Что это?**  
Когда пользователь получает доступ к тому, к чему не должен. Это самая частая уязвимость, потому что её легко упустить и использовать.

**Как это выглядит?**  
Представьте, что у вас есть ключ от номера в отеле, но он почему-то открывает и чужие номера, и даже кабинет менеджера.

**Как это работает?**
- **IDOR (Insecure Direct Object Reference)**: В URL стоит `id=123`, пользователь меняет на `id=124` и видит чужие данные, потому что сервер не проверяет права.
- **Доступ к админке**: Пользователь вводит `example.com/admin` и попадает в админ-панель, потому что её не защитили.
- **Повышение привилегий**: Обычный пользователь находит способ выполнить действия админа, например, через скрытый API.

**Что будет?**  
Утечка данных, их изменение или удаление, а в худшем случае — полный захват системы.

**Как защититься?**
- Запрещайте доступ ко всему по умолчанию, разрешайте только то, что нужно.
- Проверяйте права на сервере, а не только в интерфейсе (скрытая кнопка — не защита).
- Используйте сложные идентификаторы, например UUID, вместо простых чисел (1, 2, 3...).

---

### A02:2021 — Криптографические сбои
**Что это?**  
Проблемы с шифрованием или его отсутствие. Это когда данные, которые должны быть защищены, оказываются уязвимыми.

**Как это выглядит?**  
Вы отправляете письмо с номером карты на открытке, которую может прочитать любой. Или кладете данные в сейф, а код от него пишете на дверце.

**Как это работает?**
- Пароли хранятся в открытом виде или с устаревшими алгоритмами вроде MD5.
- Данные передаются по HTTP, а не HTTPS.
- Используются слабые алгоритмы шифрования (например, DES).
- Ключи шифрования "зашиты" в коде приложения.

**Что будет?**  
Утечка данных, взлом аккаунтов, финансовые и репутационные потери.

**Как защититься?**
- Включите HTTPS для всего сайта.
- Хешируйте пароли с помощью современных алгоритмов (bcrypt, Argon2).
- Используйте проверенные алгоритмы шифрования (AES-256).
- Храните ключи безопасно, например, в Key Vault.

---

### A03:2021 — Инъекции
**Что это?**  
Злоумышленник отправляет приложению вредоносные данные, которые оно принимает за команду. Это целая группа уязвимостей.

**Как это выглядит?**  
Вы просите секретаря найти папку «Иванов», а вместо этого говорите: «Найди папку "Иванов" и удали весь архив». Если секретарь не проверяет, он всё выполнит.

**Как это работает?**
- **SQL-инъекция**: В поле логина вводят `' OR 1=1 --`, и сервер пропускает без пароля.
- **XSS (Cross-Site Scripting)**: В комментарий вставляют `<script>alert('Hacked')</script>`, и код выполняется в браузере другого пользователя.
- **Командные инъекции**: Через уязвимость в приложении запускают команды операционной системы.

**Что будет?**  
Кража данных, обход паролей, захват сервера или выполнение действий от имени другого пользователя.

**Как защититься?**
- Используйте параметризованные запросы для баз данных.
- Проверяйте, что вводит пользователь, и фильтруйте всё подозрительное.
- Экранируйте специальные символы (`<`, `>`) перед выводом на страницу.

---

### A04:2021 — Небезопасный дизайн
**Что это?**  
Когда уязвимость заложена в самой архитектуре приложения, а не в коде. Безопасность просто не продумали на старте.

**Как это выглядит?**  
Вы строите банк с супернадежной дверью, но стены — из картона. Дверь крепкая, а вот дизайн провальный.

**Как это работает?**
- Форма сброса пароля требует только логин, и злоумышленник может массово запрашивать сброс для всех пользователей.
- Нет ограничений на добавление товаров в корзину — можно "положить" миллиард и обрушить сервер.
- Нет защиты от брутфорса — можно бесконечно подбирать пароли.

**Что будет?**  
Уязвимости, которые сложно и дорого исправлять, потому что они в самой основе системы.

**Как защититься?**
- Проводите моделирование угроз (Threat Modeling) на этапе проектирования.
- Включайте безопасность с самого начала разработки (принцип Shift Left).
- Используйте проверенные шаблоны проектирования.

---

### A05:2021 — Неправильная настройка
**Что это?**  
Ошибки в настройке серверов, баз данных или облачных сервисов. Часто это настройки по умолчанию, которые забыли поменять.

**Как это выглядит?**  
Вы ставите крутую систему видеонаблюдения, но оставляете логин `admin` и пароль `admin`. И окно открытым.

**Как это работает?**
- Веб-сервер показывает список файлов в папке, потому что включили листинг директорий.
- Ошибки выдают слишком много информации: пути к файлам, SQL-запросы.
- Облачное хранилище (например, S3) случайно сделали общедоступным.
- Оставили учетки по умолчанию, которые легко взломать.

**Что будет?**  
Утечка данных, несанкционированный доступ или полный захват системы.

**Как защититься?**
- "Укрепляйте" системы: отключайте ненужные функции, закрывайте лишние порты.
- Настройте кастомные страницы ошибок, чтобы они не выдавали лишнего.
- Используйте инструменты для проверки конфигураций.

---

### A06:2021 — Устаревшие компоненты
**Что это?**  
Использование старых библиотек, фреймворков или ПО с известными уязвимостями. Большая часть кода в приложениях — это сторонние компоненты.

**Как это выглядит?**  
Вы строите дом из кирпичей, которые, как все знают, трескаются под нагрузкой.

**Как это работает?**
- Приложение использует старую версию `log4j` с уязвимостью Log4Shell.
- Фронтенд работает на старом jQuery, где есть XSS-уязвимости.
- Сервер на устаревшем PHP или Apache, для которых есть готовые эксплойты.

**Что будет?**  
От утечки данных до полного захвата сервера — зависит от уязвимости.

**Как защититься?**
- Ведите учет всех библиотек и их версий.
- Используйте сканеры вроде `npm audit` или OWASP Dependency-Check.
- Регулярно обновляйте всё, что можно.

---

### A07:2021 — Сбои аутентификации
**Что это?**  
Проблемы с проверкой, кто вы, и управлением вашей сессией.

**Как это выглядит?**  
Охранник пускает в здание всех, кто говорит: "Я тут работаю", не проверяя пропуск. А пропуска, которые он выдает, действуют вечно.

**Как это работает?**
- Разрешены слабые пароли вроде `123456`.
- Нет защиты от брутфорса или атак с украденными паролями.
- ID сессии легко угадать, и он не меняется после входа.

**Что будет?**  
Взлом аккаунтов, включая админские.

**Как защититься?**
- Включите двухфакторную аутентификацию (MFA).
- Требуйте сложные пароли.
- Ограничивайте попытки входа и блокируйте подозрительные аккаунты.
- Используйте длинные и случайные ID сессий.

---

### A08:2021 — Нарушение целостности
**Что это?**  
Проблемы с проверкой целостности кода или данных. Например, когда обновления или данные приходят из ненадежных источников.

**Как это выглядит?**  
Вы качаете обновление с официального сайта, но по пути его подменяют на вирус. А ваша система не проверяет, что файл настоящий.

**Как это работает?**
- Приложение десериализует данные из ненадежного источника и выполняет вредоносный код.
- Зависимости качаются из скомпрометированного репозитория.
- Хакер вмешивается в CI/CD и внедряет свой код в приложение.

**Что будет?**  
От выполнения вредоносного кода до полного захвата системы.

**Как защититься?**
- Проверяйте цифровые подписи всех обновлений и библиотек.
- Защищайте CI/CD-конвейер.
- Не десериализуйте данные из непроверенных источников.

---

### A09:2021 — Проблемы с логированием и мониторингом
**Что это?**  
Когда атаки не замечают из-за плохих логов или их отсутствия.

**Как это выглядит?**  
В банке ограбление, но камеры не работают, а сигнализация отключена. Никто не знает, что украли и кто.

**Как это работает?**
- Важные события (входы, ошибки) не записываются.
- Логи хранятся локально и легко стираются хакером.
- Нет алертов о подозрительной активности, например, о сотне попыток входа за минуту.

**Что будет?**  
Атака может идти месяцами, а вы не узнаете. Расследовать тоже не получится.

**Как защититься?**
- Логируйте все важные события.
- Используйте защищенные системы логирования (SIEM).
- Настройте алерты на подозрительные действия.

---

### A10:2021 — Подделка запросов на стороне сервера (SSRF)
**Что это?**  
Злоумышленник заставляет сервер отправить запрос туда, куда ему не положено.

**Как это выглядит?**  
Вы просите робота-курьера принести документ из архива, а вместо номера документа даете адрес секретного сервера. Робот послушно идет туда и приносит всё, что нашел.

**Как это работает?**
- Приложение делает скриншот сайта по URL. Хакер подсовывает внутренний адрес (`http://192.168.0.1/admin`), и сервер выдает админ-панель.
- Атака на метаданные облака (`http://169.254.169.254/...`) крадет ключи доступа.

**Что будет?**  
Доступ к внутренним сервисам, утечка данных, обход файрволов.

**Как защититься?**
- Разрешайте серверу обращаться только к проверенным доменам и IP.
- Проверяйте URL, которые дает пользователь.
- Изолируйте внутренние ресурсы от внешнего интерфейса сервера.

---

### Что такое CSRF?
**CSRF (Cross-Site Request Forgery)** — это когда хакер заставляет ваш браузер выполнить действие на сайте, где вы уже залогинены, без вашего ведома.

**Как это выглядит?**  
Вы — босс, а ваш браузер — доверчивый помощник с пропуском в банк. Вот что происходит:
1. Вы логинитесь в банке (`my-bank.com`), и браузер получает "пропуск" (cookie).
2. Потом открываете в новой вкладке сайт хакера (`evil-blog.com`).
3. На этом сайте спрятан код, который говорит браузеру: "Иди в банк и переведи 1000$ на счет хакера".
4. Браузер видит ваш пропуск и выполняет команду, а банк думает, что это вы.

**Ключевой момент**: Хакер не крадет ваши данные, он просто использует ваш браузер, чтобы сделать что-то от вашего имени.

**Как защищаются?**  
Современные фреймворки (Django, Rails, Laravel) включают защиту от CSRF по умолчанию. Самый популярный способ — **Anti-CSRF токены**:
- Сервер создает уникальный токен для каждой формы (например, перевода денег).
- Токен отправляется с формой и проверяется на сервере.
- Хакер не может угадать токен, и его поддельный запрос не пройдет.

Благодаря встроенной защите CSRF-атаки стали редкостью.

---

## 3. Защита на всех уровнях: Defense in Depth

### 1. Same-Origin Policy (SOP): браузер на страже
**Что это?**  
SOP — это правило в браузерах, которое не дает скриптам с одного сайта лезть на другой. Это как забор, который защищает ваши данные от чужаков.

**Что такое origin?**  
Origin — это комбинация протокола (`http` или `https`), домена (`example.com`) и порта (`80` или `443`). Например:
- `https://example.com` и `https://example.com:443` — один origin.
- `http://example.com` и `https://example.com` — разные (протокол разный).
- `https://sub.example.com` и `https://example.com` — тоже разные (хосты разные).

**Как это работает?**
- Скрипт с `https://example.com` не может отправить запрос на `https://other.com` или прочитать данные оттуда без разрешения.
- Это защищает от XSS и CSRF, когда хакер пытается украсть данные через ваш браузер.

**Что ограничивает?**
- Запросы через `XMLHttpRequest` или `Fetch API` блокируются, если origin другой.
- Cookies, iframe и другие ресурсы тоже под SOP.
- Но картинки, скрипты и CSS грузятся с других сайтов, хотя их содержимое скриптам недоступно.

**Проблемы и обход:**
- Для обмена данными между сайтами есть CORS (см. ниже) или устаревший JSONP.
- Хакеры могут обойти SOP через XSS, так что важно всё правильно настраивать.

---

### 2. CORS: делимся данными безопасно
**CORS (Cross-Origin Resource Sharing)** — это способ разрешить сайтам обмениваться данными, несмотря на SOP, но под контролем.

**Как это работает?**
- Браузер отправляет запрос с заголовком `Origin`, показывая, с какого сайта он пришел.
- Сервер отвечает заголовками, которые разрешают или запрещают доступ:
  - `Access-Control-Allow-Origin`: какие сайты могут получить данные (например, `https://example.com` или `*` для всех).
  - `Access-Control-Allow-Methods`: какие методы разрешены (`GET`, `POST`).
  - `Access-Control-Allow-Headers`: какие заголовки можно отправлять.
  - `Access-Control-Allow-Credentials`: можно ли отправлять cookie.

**Пример:**
1. Сайт `https://client.com` запрашивает данные с `https://api.com`.
2. Браузер добавляет `Origin: https://client.com`.
3. Сервер отвечает: `Access-Control-Allow-Origin: https://client.com`.
4. Если доступ разрешен, браузер дает скрипту обработать ответ. Если нет — блокирует.

**Preflight-запросы:**
Для сложных запросов (например, `PUT`) браузер сначала отправляет запрос `OPTIONS`, чтобы спросить у сервера, можно ли. Сервер должен ответить нужными заголовками.

**Проблемы:**
- Если поставить `Access-Control-Allow-Origin: *` с поддержкой cookies, это создаст уязвимость.
- CORS не защищает от CSRF, так как запросы всё равно могут отправляться.

---

### 3. Content Security Policy (CSP): контроль ресурсов
**CSP** — это инструмент, который решает, какие скрипты, стили и другие ресурсы можно загружать на страницу. Это как фильтр, защищающий от XSS.

**Как это работает?**
- CSP задается через заголовок `Content-Security-Policy` или тег `<meta>`.
- Указывает, какие источники доверенные для скриптов, стилей, картинок и т.д.
- Пример:
  ```http
  Content-Security-Policy: default-src 'self'; script-src 'self' https://trusted.com; style-src 'self';
  ```
  - `default-src 'self'`: всё грузится только с текущего сайта.
  - `script-src 'self' https://trusted.com`: скрипты только с текущего сайта и `trusted.com`.
  - `style-src 'self'`: стили только с текущего сайта.

**Что умеет CSP?**
- Ограничивает, откуда грузятся ресурсы.
- Запрещает inline-скрипты (`<script>`) и стили в HTML, требуя внешние файлы.
- Поддерживает nonce (уникальные коды) или хэши для безопасных inline-скриптов.
- Может отправлять отчеты о нарушениях, не блокируя их (режим report-only).

**Пример защиты от XSS:**
Без CSP хакер может внедрить `<script>alert('XSS')</script>`. С CSP, где разрешены только скрипты с `'self'`, такой код не сработает.

**Проблемы:**
- Слишком строгие настройки могут сломать сайт.
- Работает только в современных браузерах.
- Не защищает от атак вроде CSRF, если они не связаны с ресурсами.

---

## Тестирование безопасности: как найти уязвимости


#### 1. SAST (Static Application Security Testing)
- **Описание**: Анализ исходного кода без запуска приложения для поиска уязвимостей (инъекции, слабое шифрование).
- **Как работает**: Сканирует код/байт-код, ищет подозрительные паттерны, интегрируется в CI/CD.
- **Находит**: SQL-инъекции (A03:2021), проблемы с вводом, устаревшие криптофункции (A02:2021).
- **Плюсы**:
  - Обнаружение уязвимостей до запуска.
  - Проверяет весь код.
  - Не требует тестовой среды.
- **Минусы**:
  - Ложные срабатывания.
  - Не видит конфигурационные или runtime-ошибки.
- **Инструменты**: SonarQube, Checkmarx, Fortify, Semgrep.
- **Пример**: SonarQube в CI/CD предлагает заменить `String query = "SELECT * FROM users WHERE id = " + userId;` на параметризованный запрос.

#### 2. DAST (Dynamic Application Security Testing)
- **Описание**: Тестирование работающего приложения через HTTP-запросы, имитируя атаки хакера.
- **Как работает**: Отправляет вредоносные запросы, анализирует ответы сервера в тестовой/продакшен-подобной среде.
- **Находит**: XSS (A03:2021), ошибки конфигурации (A05:2021), SSRF (A10:2021).
- **Плюсы**:
  - Ловит runtime-уязвимости.
  - Не нужен доступ к коду.
  - Проверяет конфигурацию.
- **Минусы**:
  - Пропускает неисполняемый код.
  - Требует тестовой среды.
- **Инструменты**: OWASP ZAP, Burp Suite, Acunetix, Netsparker.
- **Пример**: OWASP ZAP обнаруживает XSS, отправляя `<script>alert('XSS')</script>` и видя выполнение кода.

#### 3. SCA (Software Composition Analysis)
- **Описание**: Анализ сторонних библиотек на уязвимости и лицензионные проблемы.
- **Как работает**: Сканирует файлы зависимостей (`package.json`, `pom.xml`), сравнивает с базами CVE/NVD.
- **Находит**: Уязвимые компоненты (A06:2021), баги вроде Log4Shell, лицензионные нарушения.
- **Плюсы**:
  - Быстрое обнаружение известных уязвимостей.
  - Проверяет лицензии.
  - Интеграция в CI/CD.
- **Минусы**:
  - Проверяет только сторонний код.
  - Зависит от актуальности баз.
- **Инструменты**: OWASP Dependency-Check, Snyk, Dependabot, WhiteSource (Mend).
