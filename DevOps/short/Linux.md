# Справочник по Linux

## 1. Основы операционной системы

**Операционная система (ОС)** — это программа, управляющая ресурсами компьютера и выступающая посредником между оборудованием и
приложениями.

**Linux** — это Unix-подобная ОС с открытым исходным кодом. Его **ядро (Kernel)** напрямую взаимодействует с оборудованием (процессор,
память, диски), управляя им через **драйверы**. Приложениям Linux предоставляет стандартизированный интерфейс (системные вызовы),
абстрагируя их от деталей работы конкретного "железа".

**Типы ядер:**

* **Монолитное ядро (Linux):** Все основные функции (управление памятью, процессами, драйверы) работают в едином адресном пространстве. Это
  обеспечивает высокую производительность. Для гибкости Linux использует **модули**, которые можно динамически загружать и
  выгружать (`lsmod`, `modprobe`), не перезагружая систему.
* **Микроядро:** В ядре реализован лишь минимальный набор функций, а драйверы и файловые системы работают как отдельные процессы в
  пользовательском пространстве. Это повышает надежность (сбой драйвера не "уронит" ядро), но снижает производительность.

## 2. Архитектура Linux

### 2.1. Пространства: User Space и Kernel Space

* **User Space (Пользовательское пространство):** Область, где работают пользовательские приложения (`bash`, `firefox`), библиотеки и
  утилиты. Программы здесь имеют ограниченные права и не могут напрямую обращаться к оборудованию. Для этого они используют системные
  вызовы.
* **Kernel Space (Пространство ядра):** Привилегированная область, где выполняется ядро, драйверы и ключевые подсистемы. Код в этом
  пространстве имеет полный доступ ко всем ресурсам. Ошибка здесь может привести к сбою всей системы (**kernel panic**).

### 2.2. Файловая система

В Linux всё представлено как файл, а структура каталогов иерархична и стандартизирована (FHS).

* `/bin`: Основные исполняемые файлы (`ls`, `cp`).
* `/etc`: Конфигурационные файлы.
* `/var`: Изменяемые данные (логи в `/var/log`, кэш).
* `/dev`: Файлы устройств (например, `/dev/sda1` — первый раздел диска).
* `/proc`, `/sys`: Виртуальные файловые системы для взаимодействия с ядром.

**VFS (Virtual File System)** — уровень абстракции в ядре, который предоставляет единый интерфейс для работы с различными файловыми
системами (ext4, XFS, NFS и др.).

### 2.3. Драйверы и `udev`

* **Драйвер** — это "переводчик" между ядром и устройством.
* **`udev`** — это менеджер устройств, который динамически создает и удаляет файлы в каталоге `/dev` при подключении или отключении
  оборудования (например, USB-флешки). Он работает на основе правил, хранящихся в `/etc/udev/rules.d/`.

## 3. Управление процессами

* **Процесс** — это выполняющаяся программа со своим изолированным виртуальным адресным пространством, ресурсами и идентификатором (PID).
  Создается через системные вызовы `fork()` и `exec()`.
* **Поток (thread)** — это "легковесный процесс", который выполняется внутри родительского процесса и разделяет с ним память и ресурсы, но
  имеет собственный стек и счетчик команд. Переключение между потоками гораздо "дешевле", чем между процессами.
* **Планировщик CFS (Completely Fair Scheduler)** — компонент ядра, который "справедливо" распределяет процессорное время между процессами.
  Приоритет можно регулировать с помощью `nice`.
* **Сигналы** — асинхронные уведомления процессам. Основные сигналы:
    * `SIGTERM (15)`: "Вежливый" запрос на завершение.
    * `SIGKILL (9)`: Принудительное, неотвратимое завершение.

**Инструменты:** `ps`, `top`, `htop`, `kill`.

## 4. Управление памятью

* **Виртуальная память:** Механизм, предоставляющий каждому процессу изолированное адресное пространство, которое отображается на физическую
  память (RAM) через таблицы страниц (управляются MMU).
* **Swap:** Область на диске, используемая как расширение RAM. Ядро перемещает туда неактивные страницы памяти. Параметр `swappiness` (
  0-100) регулирует агрессивность использования swap.
* **OOM Killer (Out-of-Memory Killer):** Механизм, который принудительно завершает "прожорливый" процесс, чтобы спасти систему от полного
  краха при нехватке памяти.

**Инструменты:** `free`, `vmstat`, `cat /proc/meminfo`.

## 5. Диски и файловые системы

* **Типы ФС:**
    * `ext4`: Стабильная, быстрая, с журналированием для защиты от сбоев.
    * `Btrfs`, `ZFS`: Современные ФС с поддержкой **Copy-on-Write (CoW)**, снапшотов и встроенного управления томами/RAID.
* **Монтирование:** Подключение файловой системы к каталогу.
    * `mount`, `umount` — команды для монтирования/размонтирования.
    * `/etc/fstab` — файл для автоматического монтирования при загрузке.
* **Управление разделами:**
    * `fdisk`, `parted` — утилиты для разметки дисков.
    * **LVM (Logical Volume Manager)** — позволяет гибко управлять дисковым пространством: объединять диски в группы и создавать логические
      тома изменяемого размера.
* **Права доступа:**
    * `chmod`: Изменение прав (чтение, запись, исполнение).
    * `chown`: Смена владельца и группы.
    * **SUID/SGID/Sticky Bit**: Специальные права для изменения поведения при исполнении файлов или работе с каталогами.

**Инструменты:** `df` (свободное место), `du` (использование места), `fsck` (проверка ФС).

## 6. Сетевая подсистема

Сетевой стек TCP/IP встроен в ядро и работает по многоуровневой модели.

* **Уровни:**
    1. **Канальный:** Управление передачей данных в локальной сети (Ethernet, MAC-адреса).
    2. **Сетевой:** Маршрутизация пакетов между сетями (протокол **IP**, адресация, **ICMP** для диагностики).
    3. **Транспортный:** Обеспечение связи между приложениями.
        * **TCP:** Надежная доставка с установкой соединения (веб, почта).
        * **UDP:** Быстрая доставка без гарантий (DNS, VoIP, игры).
* **Конфигурация:**
    * **`ip`**: Современная утилита для управления интерфейсами и маршрутизацией (`ip addr`, `ip route`). Заменяет устаревшие `ifconfig`
      и `route`.
    * **NetworkManager**: Демон для автоматического управления сетевыми подключениями (`nmcli`).
    * **/etc/resolv.conf**: Файл для настройки DNS-серверов.
* **Безопасность:**
    * **Фаервол:** `iptables` (классический), `nftables` (современный) или `firewalld` (высокоуровневая оболочка) для фильтрации трафика.
    * **SSH (Secure Shell):** Протокол для безопасного удаленного доступа. Ключевая практика — **аутентификация по ключам** и отключение
      входа по паролю (`PasswordAuthentication no`) и для `root` (`PermitRootLogin no`) в файле `/etc/ssh/sshd_config`.

**Инструменты:** `ping`, `traceroute`, `ss`, `tcpdump`, `wireshark`, `iperf`.

## 7. Пользователи и безопасность

* **Пользователи и группы:** Основа разграничения прав. Управляются через `useradd`, `usermod`. Информация хранится
  в `/etc/passwd`, `/etc/group`, а зашифрованные пароли — в `/etc/shadow`.
* **PAM (Pluggable Authentication Modules):** Гибкий фреймворк для настройки методов аутентификации.
* **Принудительный контроль доступа (MAC):**
    * **SELinux:** Очень гранулированная система на основе меток безопасности (используется в RHEL/CentOS).
    * **AppArmor:** Система на основе профилей, привязанных к путям исполняемых файлов (используется в Ubuntu/Debian).
* **Шифрование:**
    * **LUKS:** Стандарт для полнодискового шифрования.
    * **GPG:** Для шифрования отдельных файлов и сообщений.

## 8. Автоматизация и мониторинг

* **Bash-скриптинг:** Автоматизация задач с помощью командной строки, переменных, циклов и условий. Основные утилиты для обработки
  текста: `grep`, `sed`, `awk`, `find`.
* **`cron`**: Системный планировщик для выполнения задач по расписанию. Настраивается через `crontab -e`.
* **Системы управления конфигурацией (IaC):** `Ansible`, `Puppet`, `Chef`.
* **Логирование:**
    * `dmesg`: Логи ядра (проблемы с оборудованием).
    * `journalctl`: Централизованный журнал `systemd`.
* **Инструменты мониторинга:** `Nagios`, `Prometheus` (сбор метрик) + `Grafana` (визуализация).

## 9. Виртуализация и контейнеры

* **Виртуализация:** Создание виртуальных машин (ВМ) с полноценной гостевой ОС.
    * **KVM:** Технология в ядре Linux, превращающая его в высокопроизводительный гипервизор.
    * **QEMU:** Эмулятор аппаратного обеспечения для ВМ.
    * **libvirt:** API для управления различными гипервизорами.
* **Контейнеризация:** Изоляция приложений на уровне ОС, использующих общее ядро хоста.
    * **Docker, Podman:** Платформы для управления контейнерами.
    * **Kubernetes (K8s):** Оркестратор для управления контейнерами в кластере.
    * **Основа контейнеров:**
        * **Namespaces:** Изоляция ресурсов (PID, сеть, файловая система).
        * **cgroups:** Ограничение потребления ресурсов (CPU, память).

## 10. Отладка и производительность

* **`strace`**: Отслеживает системные вызовы процесса (работа с файлами, сетью).
* **`perf`**: Мощный профилировщик для анализа производительности CPU.
* **`iostat`, `iotop`**: Анализ нагрузки на дисковую подсистему.
* **`kdump` и `crash`**: Механизм для сохранения и анализа дампа памяти в случае паники ядра.

## 11. Службы и `sudo`

* **Службы (сервисы):** Программы, работающие в фоновом режиме (`sshd`, `nginx`). В современных системах управляются через `systemd`.
* **`systemctl`**: Команда для управления службами (`start`, `stop`, `restart`, `status`, `enable`, `disable`).
* **`sudo`**: Команда, позволяющая выполнять другие команды с правами суперпользователя (`root`). Повышает безопасность, так как позволяет
  работать под обычным пользователем и повышать привилегии только при необходимости.